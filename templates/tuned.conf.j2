[main]
include={{ item.1 }}
summary={{ item.1 }} + TCP/RAID tweaks + AMDGPU pp_power_profile_mode = {{ item.0.value }} ({{ item.0.name }})

[sysctl]
net.core.default_qdisc=fq
# 'bbr2' requires a [modified] supporting kernel - stock Fedora kernels do *not* support it (currently)
#    eg: 'kernel-xanmode-edge' from COPR 'rmnscnce/kernel-xanmod'
net.ipv4.tcp_congestion_control=bbr2
net.core.rmem_max=33554432
net.core.wmem_max=33554432
dev.raid.speed_limit_min=600000
dev.raid.speed_limit_max=9000000
# allow some games to run (eg: DayZ)
vm.max_map_count=1048576

{% if 'default' in item.0.name %}
# reference/execute AMDGPU clock control *reset* script
[gpuresetscript]
type=script
script=${i:PROFILE_DIR}/amdgpu-clock-reset.sh

[sysfs]
# configure GPU power/clock characteristics
# ref: https://docs.kernel.org/gpu/amdgpu/thermal.html
/sys/class/drm/{{ card }}/device/pp_power_profile_mode = {{ item.0.value }}
/sys/class/drm/{{ card }}/device/power_dpm_force_performance_level = auto
# give default profile {{ power_max_multi * 50.0 |int }}% (max) power capability
/sys/class/drm/{{ card }}/device/hwmon/hwmon9/power1_cap = {{ power_cap_half }}
{% endif %}
{% if 'custom' in item.0.name %}
[sysfs]
# configure GPU power/clock characteristics
# ref: https://docs.kernel.org/gpu/amdgpu/thermal.html
/sys/class/drm/{{ card }}/device/pp_power_profile_mode = {{ item.0.value }}
# give this custom oriented profile {{ power_max_multi * 100.0 |int }}% of the power capability
/sys/class/drm/{{ card }}/device/hwmon/hwmon9/power1_cap = {{ power_cap }}

# reference/execute AMDGPU clock control script
[gpuclockscript]
type=script
script=${i:PROFILE_DIR}/amdgpu-clock.sh
{% endif %}
